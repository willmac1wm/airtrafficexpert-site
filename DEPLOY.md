# ðŸš€ Deployment Guide

## Option 1: Automatic Deployment (Recommended)

**Set up once, then every push to `main` auto-deploys!**

1. **Create a Service Account** (one-time setup):
   ```bash
   # In Google Cloud Console:
   # 1. Go to IAM & Admin > Service Accounts
   # 2. Create service account named "github-actions"
   # 3. Grant roles: Cloud Run Admin, Service Account User
   # 4. Create JSON key and download it
   ```

2. **Add GitHub Secret**:
   - Go to your GitHub repo â†’ Settings â†’ Secrets and variables â†’ Actions
   - Click "New repository secret"
   - Name: `GCP_SA_KEY`
   - Value: Paste the entire JSON key file content
   - Click "Add secret"

3. **Push to main** - That's it! Every push auto-deploys.

## Option 2: Quick Deploy Script

Run the deployment script:
```bash
chmod +x deploy.sh
./deploy.sh
```

## Option 3: Manual Deploy

If the script doesn't work, deploy manually:

```bash
# 1. Build the app
npm run build

# 2. Deploy to Cloud Run
gcloud run deploy air-traffic-expert-portal \
    --source . \
    --region us-west1 \
    --platform managed \
    --allow-unauthenticated
```

## Prerequisites

1. **Install gcloud CLI**: https://cloud.google.com/sdk/docs/install
2. **Authenticate**: `gcloud auth login`
3. **Set project**: `gcloud config set project 495546644086`

## Troubleshooting

### Build fails
- Check that all dependencies are installed: `npm install`
- Check Node.js version: `node --version` (should be 18+)

### Deployment fails
- Verify you're authenticated: `gcloud auth list`
- Check project: `gcloud config get-value project`
- Check Cloud Run API is enabled: `gcloud services enable run.googleapis.com`

### Site not working after deploy
- Check Cloud Run logs: `gcloud run services logs read air-traffic-expert-portal --region us-west1`
- Verify the service is running: `gcloud run services describe air-traffic-expert-portal --region us-west1`

### Links don't work
- âœ… **FIXED**: Switched from HashRouter to BrowserRouter
- Make sure `server.js` is serving `index.html` for all routes
- Check browser console for JavaScript errors

### JavaScript not loading
- Check browser console for 404 errors on `/assets/*` files
- Verify `dist/assets/` files exist after build
- Check Cloud Run logs for server errors

### Changes not appearing
- Rebuild: `npm run build`
- Redeploy: `./deploy.sh` or push to GitHub
- Hard refresh browser: Cmd+Shift+R (Mac) or Ctrl+Shift+R (Windows)

## Architecture

- **Frontend**: React + Vite (SPA)
- **Server**: Express.js (serves static files + handles routing)
- **Deployment**: Google Cloud Run (Docker container)
- **Routing**: BrowserRouter (clean URLs, no hash)

## File Structure

- `server.js` - Express server for Cloud Run
- `Dockerfile` - Container configuration
- `vite.config.ts` - Build configuration
- `dist/` - Built files (generated by `npm run build`)
- `.github/workflows/deploy.yml` - Auto-deployment workflow
- `deploy.sh` - Manual deployment script

## Quick Reference

```bash
# Local development
npm run dev

# Build for production
npm run build

# Test production build locally
npm run preview

# Deploy (choose one)
./deploy.sh                    # Script
gcloud run deploy ...          # Manual
git push origin main          # Auto (if GitHub Actions set up)
```
